<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.0.2/chart.min.js"
        integrity="sha512-dnUg2JxjlVoXHVdSMWDYm2Y5xcIrJg1N+juOuRi0yLVkku/g26rwHwysJDAMwahaDfRpr1AxFz43ktuMPr/l1A=="
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="geral.css">
    <link rel="stylesheet" href="">
    <title>Minha Plantação</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
    <script src="http://www.chartjs.org/dist/2.7.1/Chart.js"></script>
    <script src="http://www.chartjs.org/samples/latest/utils.js"></script>
    <style>
        canvas {
            -moz-user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
        }
    </style>
</head>

<!--INÍCIO DO CABECALHO-->

<body>
    <div class="cabecalho">
        <div class="caixa">
            <div class="logo">
                <span>WiSoy</span>
                <img src="./wisoy.png" alt="logo WiSoy">
            </div>
        </div>
    </div>

    <!--FIM DO CABECALHO-->

    <!--INÍCIO HAMBURGUER-->



    <div class="menu">
        <div><img id="menu-hamb" class="logo_menu" src="menu_bar.png" onclick="toggleMenu()"></div>
        <div class="caixa_menu" id="box_menu">
            <nav id="menu-hamb">
                <ul>
                    <div class="itens_hamburguer" id="imagem_itens"><img src="icone perfil.png">
                        <li onclick="closeMenu()">Minha Conta</li>
                    </div>
                    <div class="itens_hamburguer">
                        <li onclick="closeMenu()">Minha Plantação</li>
                    </div>
                    <div class="itens_hamburguer">
                        <li onclick="closeMenu()">Histórico</li>
                    </div>
                    <div class="itens_hamburguer">
                        <li onclick="closeMenu()">Notificações</li>
                    </div>

                    <div class="itens_hamburguer" id="but_sair">
                        <li onclick="closeMenu()">Sair</li>
                    </div>
                </ul>
            </nav>
        </div>
    </div>

    <!--FIM DO HAMBURGUER-->



    <div style="height: 500px; width: 600px; float: right;  margin-right: 150px;">
        <canvas id="chart_umidade_semana" width="300px" height="200px"></canvas>
    </div>


    <div style="height: 500px; width: 600px; float: right;  margin-right: 150px;">
        <canvas id="chart_umidade_hora" width="300px" height="200px"></canvas>
    </div>

    <div style="height: 500px; width: 600px; float: right;  margin-right: 150px;">
        <canvas id="chart_umidade_mes" width="300px" height="200px"></canvas>
    </div>



    <!-- INÍCIO API-->
    <div style="display: none;">
        <h1>Sensor LM35 - Temperatura</h1>
        <section>
            <h2>Média: <label id='average'>0.00</label></h2>
            <h2>Média Hora: <label id='averageHour'>0.00</label></h2>
        </section>
        <section style="width:100%">
            <canvas id="chart"></canvas>
            <section>
    </div>
    <div id="grafico_bunitu" style="display: none;">
        <section>
            <h1>Sensor DHT11 - Umidade</h1>
            <h2>Média: <label id='averageHumidity'>0.00</label></h2>
            <h2>Média Hora: <label id='averageHourHumidity'>0.00</label></h2>
        </section>
        <section style="width:100%">
            <canvas id="chart-humidity"></canvas>
            <section>
    </div>
    <div style="display: none;">
        <section>
            <h1>Sensor TRC5000 - Switch</h1>
        </section>
        <section style="width:100%">
            <canvas id="chart-switch"></canvas>
            <section>
    </div>
    <div style="display: none;">
        <section>
            <h1>Sensor LDR - Luminosidade</h1>
            <h2>Média: <label id='averageLumi'>0.00</label></h2>
            <h2>Média Hora: <label id='averageHourLumi'>0.00</label></h2>
        </section>
        <section style="width:100%">
            <canvas id="chart-lumi"></canvas>
            <section>
    </div>


    <!--FIM API -->


    <!--INÍCIO BOTÕES MUDAR GRÁFICO-->
    <div class="corpo_mudar_graficos">

        <div class="but_graficos" id="botao_1">hora</div>

        <div class="but_graficos" id="botao_2">semana</div>

        <div class="but_graficos" id="botao_3">mês</div>

    </div>

    <!--FIM BOTÕES MUDAR GRÁFICO-->

    <!--INÍCIO BOTÕES-->

    <div class="corpo_dashboard">
        <div class="colunas">
            <div class="caixa_but">

                <div class="but_display_digital" onclick="calcular()" id="but_1">Sensor 1</div>

                <div class="but_display_digital" id="but_2">Sensor 2</div>

                <div class="but_display_digital" id="but_3">Sensor 3</div>

                <div class="but_display_digital" id="but_4">Sensor 4</div>


            </div>

            <!--FIM BOTÕES-->

            <!--INÍCIO MENSAGEM(GRÁFICO)-->

            <!-- <div id="mensagem" class="caixa_graficos"></div> 
        </div> -->
        </div>
        <!--FIM MENSAGEM(GRÁFICO)-->



        <!--INÍCIO DO CANVAS CHART.JS-->


        <div style="width: 500px; padding: 150px 0px 0px 300px;">
            <canvas style="display: none;" id="chart"></canvas>
        </div>

        <div id="button_detalhe" class="button_detalhes">
            <button onclick="button()">Detalhes</button>
        </div>

        <div style="width: 500px; float: right; margin: 250px 0px 0px 50px;" onclick="grafico2()">
            <canvas style="display: none;" id="chart2"></canvas>
        </div>

        <!--FIM DO CANVAS CHART.JS-->

        <!--INÍCIO RODAPÉ-->

        <div class="rodape">Copyright &copy 2021 - Todos os direitos reservados - WiSoy</div>

        <!--FIM RODAPÉ-->

</body>

</html>

<!--INÍCIO SCRIPT-->

<script>













 /*INÍCIO GRÁFICO UMIDADExSEMANA*/
 const labels = ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho']; 

const data = {

labels: labels,
    datasets : [
    {
            label: 'WiSoy',
            data: [90, 85, 95, 87, 90, 89],
            borderColor: 'rgb(224, 187, 228)',
            backgroundColor: 'rgb(149, 125, 173)',},
            {
            }
    ]
};

const config = {
    type: 'line',
    data: data,
    options: {
        responsive: false,
        plugins: {
            legend: {
                position: 'top',
            },
            title: {
                display: true,
                text: 'Umidade do solo na plantação'
            }
        }
    },
};

var umidade_semana = document.getElementById('chart_umidade_semana').getContext('2d');
var myChart = new Chart(umidade_semana, config); 


/*FIM GRÁFICO UMIDADExSEMANA*/



 /*INÍCIO GRÁFICO UMIDADExMÊS*/
 const labels_2 = ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho']; 

const data_2 = {

labels: labels_2,
    datasets : [
    {
            label: 'WiSoy',
            data: [90, 85, 95, 87, 90, 89],
            borderColor: 'rgb(224, 187, 228)',
            backgroundColor: 'rgb(149, 125, 173)',},
            {
            }
    ]
};

const config_2 = {
    type: 'line',
    data: data_2,
    options: {
        responsive: false,
        plugins: {
            legend: {
                position: 'top',
            },
            title: {
                display: true,
                text: 'Umidade do solo na plantação'
            }
        }
    },
};

var umidade_mes = document.getElementById('chart_umidade_mes').getContext('2d');
var myChart = new Chart(umidade_mes, config_2); 


/*FIM GRÁFICO UMIDADExMÊS*/




 /*INÍCIO GRÁFICO UMIDADExHORA*/
 const labels_3 = ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho']; 

const data_3 = {

labels: labels_3,
    datasets : [
    {
            label: 'WiSoy',
            data: [90, 85, 95, 87, 90, 89],
            borderColor: 'rgb(224, 187, 228)',
            backgroundColor: 'rgb(149, 125, 173)',},
            {
            }
    ]
};

const config_3 = {
    type: 'line',
    data: data_3,
    options: {
        responsive: false,
        plugins: {
            legend: {
                position: 'top',
            },
            title: {
                display: true,
                text: 'Umidade do solo na plantação'
            }
        }
    },
};

var umidade_hora = document.getElementById('chart_umidade_hora').getContext('2d');
var myChart = new Chart(umidade_hora, config_3); 


/*FIM GRÁFICO UMIDADExHORA*/





















    var context = document.getElementById("chart").getContext("2d");
    context.canvas.width = 1000;
    context.canvas.height = 300;

    var configuration = {
        type: 'line',
        data: {
            datasets: [{
                label: "Temperature x Time",
                type: 'line',
                borderColor: ['#ff3232'],
                backgroundColor: ['#ff7f7f']
            }]
        },
        options: {
            scales: {
                xAxes: [{
                    //type: 'value',
                    distribution: 'series',
                    ticks: {
                        beginAtZero: true
                    }
                }],
                yAxes: [{
                    scaleLabel: {
                        display: true,
                        labelString: 'Temperature'
                    },
                    ticks: {
                        beginAtZero: true
                    }
                }]
            },
            animation: {
                duration: 0
            }
        }
    };

    var chart = new Chart(context, configuration);

    //Função para obter os dados de temperatura do server
    //Seria mais interessante fazer isso com WebSocket, porém para fins academicos, os dados serão atualizados via HTTP

    //Esse atributo dentro do contexto serve para saber qual foi o último índice processado, assim eliminado os outros elementos na
    //hora de montar/atualizar o gráfico
    this.lastIndexTemp = 0;
    this.time = 0;

    function get_data() {

        var http = new XMLHttpRequest();
        http.open('GET', 'http://localhost:3000/api', false);
        http.send(null);

        var obj = JSON.parse(http.responseText);
        if (obj.data.length == 0) {
            return;
        }

        var _lastIndexTemp = this.lastIndexTemp;
        this.lastIndexTemp = obj.data.length;
        listTemp = obj.data.slice(_lastIndexTemp);

        listTemp.forEach(data => {
            //Máximo de 60 itens exibidos no gráfico
            if (chart.data.labels.length == 10 && chart.data.datasets[0].data.length == 10) {
                chart.data.labels.shift();
                chart.data.datasets[0].data.shift();
            }

            chart.data.labels.push(this.time++);
            chart.data.datasets[0].data.push(parseFloat(data));
            chart.update();
        });

        document.getElementById('average').textContent = obj.average;
        document.getElementById('averageHour').textContent = obj.averageHour;
    }

    //Second Graphic

    var context2 = document.getElementById("chart-humidity").getContext("2d");
    context2.canvas.width = 1000;
    context2.canvas.height = 300;

    var humidity = {
        type: 'line',
        data: {
            datasets: [{
                label: "Humidity x Time",
                type: 'line',
                borderColor: ['#3232ff'],
                backgroundColor: ['#9999ff']
            }]
        },
        options: {
            scales: {
                xAxes: [{
                    //type: 'value',
                    distribution: 'series',
                    ticks: {
                        beginAtZero: true
                    }
                }],
                yAxes: [{
                    scaleLabel: {
                        display: true,
                        labelString: 'Humidity'
                    },
                    ticks: {
                        beginAtZero: true
                    }
                }]
            },
            animation: {
                duration: 0
            }
        }
    };

    var chartHumidity = new Chart(context2, humidity);

    //Função para obter os dados de temperatura do server
    //Seria mais interessante fazer isso com WebSocket, porém para fins academicos, os dados serão atualizados via HTTP

    //Esse atributo dentro do contexto serve para saber qual foi o último índice processado, assim eliminado os outros elementos na
    //hora de montar/atualizar o gráfico
    this.lastIndexTempHumidity = 0;
    this.timeHumidity = 0;

    function get_dataHumidity() {

        var http = new XMLHttpRequest();
        http.open('GET', 'http://localhost:3000/api/humidity', false);
        http.send(null);

        var obj = JSON.parse(http.responseText);
        if (obj.data.length == 0) {
            return;
        }

        var _lastIndexTemp = this.lastIndexTempHumidity;
        this.lastIndexTempHumidity = obj.data.length;
        listTemp = obj.data.slice(_lastIndexTemp);

        listTemp.forEach(data => {
            //Máximo de 60 itens exibidos no gráfico
            if (chartHumidity.data.labels.length == 10 && chartHumidity.data.datasets[0].data.length == 10) {
                chartHumidity.data.labels.shift();
                chartHumidity.data.datasets[0].data.shift();
            }

            chartHumidity.data.labels.push(this.time++);
            chartHumidity.data.datasets[0].data.push(parseFloat(data));
            chartHumidity.update();
        });

        document.getElementById('averageHumidity').textContent = obj.average;
        document.getElementById('averageHourHumidity').textContent = obj.averageHour;

        var media = document.getElementById('averageHumidity');
        text = (media.innerText || media.textContent);
        but_1.innerHTML = `Sensor 1 xosé<br>${text}`;
        but_2.innerHTML = `${text}`;
        but_3.innerHTML = `${text}`;
        but_4.innerHTML = `${text}`;
    }

    get_dataHumidity();

    //Thirty Graphic

    var context3 = document.getElementById("chart-switch").getContext("2d");
    context3.canvas.width = 1000;
    context3.canvas.height = 300;

    var switch_sensor = {
        type: 'bar',
        data: {
            datasets: [{
                label: "Switch x Time",
                borderColor: ['rgba(0, 0, 0, 0.7)'],
                backgroundColor: ['#c97f7f'],
                borderWidth: 1.5
            }]
        },
        options: {
            responsive: true,
            scales: {
                xAxes: [{
                    //type: 'value',
                    distribution: 'series',
                    ticks: {
                        beginAtZero: true
                    }
                }],
                yAxes: [{
                    scaleLabel: {
                        display: true,
                        labelString: 'Switch'
                    },
                    ticks: {
                        beginAtZero: true
                    }
                }]
            },
            animation: {
                duration: 0
            }
        }
    };

    var chartSwitch = new Chart(context3, switch_sensor);

    //Função para obter os dados de temperatura do server
    //Seria mais interessante fazer isso com WebSocket, porém para fins academicos, os dados serão atualizados via HTTP

    //Esse atributo dentro do contexto serve para saber qual foi o último índice processado, assim eliminado os outros elementos na
    //hora de montar/atualizar o gráfico
    this.lastIndexTempHumidity = 0;
    this.timeSwitch = 0;

    function get_switch() {

        var http = new XMLHttpRequest();
        http.open('GET', 'http://localhost:3000/api/switch', false);
        http.send(null);

        var obj = JSON.parse(http.responseText);
        if (obj.data.length == 0) {
            return;
        }

        var _lastIndexTemp = this.lastIndexTempSwitch;
        this.lastIndexTempSwitch = obj.data.length;
        listTemp = obj.data.slice(_lastIndexTemp);

        listTemp.forEach(data => {
            //Máximo de 60 itens exibidos no gráfico
            if (chartSwitch.data.labels.length == 10 && chartSwitch.data.datasets[0].data.length == 10) {
                chartSwitch.data.labels.shift();
                chartSwitch.data.datasets[0].data.shift();
            }

            chartSwitch.data.labels.push(this.time++);
            chartSwitch.data.datasets[0].data.push(parseFloat(data));
            chartSwitch.update();
        });

    }

    get_switch();

    //Fourty Graphic

    var context4 = document.getElementById("chart-lumi").getContext("2d");
    context4.canvas.width = 1000;
    context4.canvas.height = 300;

    var lumi_sensor = {
        type: 'line',
        data: {
            datasets: [{
                label: "Luminosity x Time",
                type: 'line',
                borderColor: ['#ffff19'],
                backgroundColor: ['#ffff7f']
            }]
        },
        options: {
            scales: {
                xAxes: [{
                    //type: 'value',
                    distribution: 'series',
                    ticks: {
                        beginAtZero: true
                    }
                }],
                yAxes: [{
                    scaleLabel: {
                        display: true,
                        labelString: 'Luminosity'
                    },
                    ticks: {
                        beginAtZero: true
                    }
                }]
            },
            animation: {
                duration: 0
            }
        }
    };

    var chartLumi = new Chart(context4, lumi_sensor);

    //Função para obter os dados de temperatura do server
    //Seria mais interessante fazer isso com WebSocket, porém para fins academicos, os dados serão atualizados via HTTP

    //Esse atributo dentro do contexto serve para saber qual foi o último índice processado, assim eliminado os outros elementos na
    //hora de montar/atualizar o gráfico
    this.lastIndexLumi = 0;
    this.timeLumi = 0;

    function get_lumi() {

        var http = new XMLHttpRequest();
        http.open('GET', 'http://localhost:3000/api/luminosity', false);
        http.send(null);

        var obj = JSON.parse(http.responseText);
        console.log(obj)
        if (obj.data.length == 0) {
            return;
        }

        var _lastIndexTemp = this.lastIndexLumi;
        this.lastIndexLumi = obj.data.length;
        listTemp = obj.data.slice(_lastIndexTemp);

        listTemp.forEach(data => {
            //Máximo de 60 itens exibidos no gráfico
            if (chartLumi.data.labels.length == 10 && chartLumi.data.datasets[0].data.length == 10) {
                chartLumi.data.labels.shift();
                chartLumi.data.datasets[0].data.shift();
            }

            chartLumi.data.labels.push(this.time++);
            chartLumi.data.datasets[0].data.push(parseFloat(data));
            chartLumi.update();
        });

        document.getElementById('averageLumi').textContent = obj.average;
        document.getElementById('averageHourLumi').textContent = obj.averageHour;

    }

    get_lumi();

    setInterval(() => {
        get_data();
        get_dataHumidity();
        get_switch();
        get_lumi();
    }, 1000);


    //codigo autoral

    var caixa_menu = document.getElementById('box_menu');

    toggleMenu = function () {
        caixa_menu.style = 'left: 0;';
    }

    closeMenu = function () {
        caixa_menu.style = 'left: -300px;';

    }

    function calcular() {
       
        grafico_bunitu.style.display ='block';
        grafico_bunitu.style.width = '500px';
    }

    
    //  FIM DA ANIMAÇÃO HAMBURGUER

    //  INÍCIO FUNÇÕES GRÁFICOS
</script>